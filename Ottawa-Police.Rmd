---
title: Ottawa Police Open Data"
author: "Dean Jayatilleke & Junpu Xie & Dave Campbell"
date: '2024-07-10'
slug: 
categories: []
tags: ["Ottawa Police", "Open Street Maps", "Shootings", "Bike Theft", "Crime"]
subtitle: ''
summary: 'Retrieving Ottawa Police Open Data and producing plots using Open Street Maps'
output: html_document
---

## Possible Analysis and Keywords

- Open Street Maps
- Bike Thefts
- Shootings
- Crime
- Motor Vehicle Thefts
- Police Data

## Data Provider

Ottawa Police's [Community Safety Data Portal](https://data.ottawapolice.ca/) is an open-access data portal designed to provide transparent and accessible information about police activity to the public. Data is available in tabular and geographic forms, and can be freely downloaded and interacted with.  

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

## Plotting Geographical Data Points on Open Street Maps

```{r libraries}

library(leaflet) 
library(sf)
library(tidyverse)

```

A word about retrieving Ottawa Police Data.

Ottawa Police datasets are available to download as CSVs, however the download URL is generated on demand, and expires shortly, within a few days,
or sometimes even hours. For this reason, when revisiting a dataset, you may have to navigate to the dataset's "About" page and regenerate a download link.

### Shootings 

```{r shootings dataset}

#https://data.ottawapolice.ca/datasets/aeb09d77912246139014516c8eeefcd9_0/about

csv_link <- "Shootings_Open_Data_3086844035331583488.csv"

shootings <- read_csv(csv_link)

head(shootings)

```

The location of each reported shooting is given in the EPSG:2951 coordinate system, represented in the X and Y columns. 
In order to plot these points on Open Street Maps using the [Leaflet] (https://rstudio.github.io/leaflet/) library, we will need to convert to Latitude and Longitude, also
known as the EPSG:4386 coordinate system. R's Simple Features (sf) library can be used to manipulate spatial data.
[Simple Features] (https://cran.r-project.org/web/packages/sf/index.html).

```{r shootings geo data}

shootingslatlong <- st_as_sf(shootings, coords = c("x", "y"), crs = 2951) |> # Tell R that the X and Y columns represent location coordinates in the EPSG:2951 system
                    st_transform(crs = 4386 ) |> # Transform the X and Y location data into the EPSG:4386 system, aka latitude and longitude.
                    st_coordinates() # Extract the latitude and longitude data into a new dataframe that we will plot

```

```{r shootings map}

leaflet() |>
  addTiles() |>
  addMarkers(data = shootingslatlong)

```

### Bike Thefts

```{r bike thefts dataset}

#https://data.ottawapolice.ca/datasets/eff8a6410ec74136b5f611017e244a4e_0/about

csv_link <- "Bike_Theft_Open_Data_3884822422354997826.csv"

bike_thefts <- read_csv(csv_link)
bike_thefts <- bike_thefts |> rename_all(make.names)

head(bike_thefts)

```

```{r expensive_bike_thefts geo data}

expensive_bike_theftslatlong <- st_as_sf(bike_thefts |> subset(Bicycle.Value > 2000), coords = c("x", "y"), crs = 2951) |> 
                                st_transform(crs = 4386 ) |> 
                                st_coordinates() 
```

```{r expensive bike thefts map}

leaflet() |>
  addTiles() |>
  addMarkers(data = expendsive_bike_theftslatlong)

```

### Motor Vehicle Thefts

```{r motor vehicle thefts dataset}

#https://data.ottawapolice.ca/datasets/e5453a203e2a4baeac32ac4e70ce852c_0/about

csv_link <- "Auto_Theft_Open_Data_2158590371504723284.csv"

vehicle_theft <- read_csv(csv_link)

vehicle_theft <- vehicle_theft |> rename_all(make.names)

head(vehicle_theft)

```

```{r stolen volkswagons map}

stolen_volk_latlong <- st_as_sf(vehicle_theft |> subset(Vehicle.Make == "VOLK"), coords = c("x", "y"), crs = 2951) |> 
                       st_transform(crs = 4386 ) |> 
                       st_coordinates() 

leaflet() |>
  addTiles() |>
  addMarkers(data = stolen_volk_latlong)

```

### Historical Crime Data 2013 - 2022 

```{r crime dataset}

#https://data.ottawapolice.ca/datasets/25a533e5e7c945faadf37765639657a5_16/about

csv_link <- "CrimeMap_YE_-5915901148112462236.csv"

crime <- read_csv(csv_link)

crime <- crime|> rename_all(make.names)

head(crime)

```

```{r offences}

crime$Offence_Category |> unique()

```

```{r year}

crime$Reported_Year |> unique()

```

```{r break and enters 2023 map}

bande2023latlong <- st_as_sf(crime |> subset(Offence_Category == "Break and Enter" & Reported_Year == 2023), 
                    coords = c("x", "y"),
                    crs = 2951) |> 
                    st_transform(crs = 4386 ) |> 
                    st_coordinates() 

leaflet() |>
  addTiles() |>
  addMarkers(data = bande2023latlong)

```


